<!DOCTYPE html>

<html>

    <head>
        <title>Metadata</title>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        <meta charset='UTF-8'>
        <script src='metadata.js'></script> 
        <script src='base64.js'></script> 
        <script src='FileSaver.min.js'></script>
        <style>
            html {
                margin: 0px;
                padding: 0px;
            }
            body {
                margin: 0px;
                padding: 32px;
                background: #404040;
                font-family: Open Sans;
                font-weigth: 400;
                font-size: 12px;
                color: #ffffff;
            }
        </style>
    </head>
    
    <body>
        <script>
            
            function save(buffer, name) {
                var blob = new Blob([buffer], {type: "application/octet-stream"});
                saveAs(blob, name);
            }
            
            // Test 1
            MD.get('im.jpg', function(buf) {
                var jpeg = new MD.JpegResource(buf);
                
                if (!jpeg) {
                    return;
                }
            
                console.log('Extract Thumbnail');
                var thumbBuf = jpeg.getThumbnailBuffer();
                if (thumbBuf) {
                    var thumbJpeg = new MD.JpegResource(thumbBuf);
                    console.log(thumbJpeg);
                }
                
                console.log('Extract EXIF segment');
                var exifBuf = jpeg.getExifBuffer();
                if (exifBuf) {
                    var exif = new MD.TiffResource(exifBuf);
                    console.log(exif);
                }
                
                console.log('Extract Photoshop 3.0 segment');
                var photoshopBuf = jpeg.getPhotoshopBuffer();
                if (photoshopBuf) {
                    var photoshop = new MD.PhotoshopResource(photoshopBuf);
                    console.log(photoshop);
                }
                
                console.log('Extract ICC profile');
                var iccBuf = jpeg.getIccBuffer();
                if (iccBuf) {
                    console.log(iccBuf);
                }
                
                if (exif) {
                    console.log('Modify and re-insert EXIF segment');
                    var tag = exif.getTag('/ifd[0]', 0x110);
                    tag.data = 'This is a test :)';
                    jpeg.setExifBuffer(exif.save());
                }
                
                var output = jpeg.save();
                save(output, 'output.jpg');
            });
            
        
        </script>
        
    </body>

</html>